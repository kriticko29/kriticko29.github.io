---
layout: post
title: "Credential Theft via SHTML Phishing Campaign: AMON3Y Malware's Multi-Stage Stealer Analysis"
subtitle: "From Fake Downloads to Session Hijacking — How a Simple SHTML File Targets Corporate Credentials"
date: 2025-08-21 13:20:00 +0800
background: '/img/posts/Phish1/shtml-phish.jpg'
---

<h2>Introduction</h2>
<p>In the last week, I observed an unusual surge in <strong>SHTML-based phishing files</strong> specifically tailored to target enterprise users. These files are distributed via suspicious email attachments, masquerading as legitimate invoices or procurement-related documents, with the primary goal of stealing credentials and hijacking sessions to gain unauthorized access to corporate environments.</p>
<p>In this post, I’ll break down the <strong>malware stealer behavior</strong>, analyzing both the <strong>blackbox execution flow</strong> and the <strong>whitebox internals</strong> of one such SHTML sample named <code>Quotation-Q-1993.shtml</code>. While the page appears crude at first glance, it packs a multi-layered phishing chain that leverages deception, dynamic branding, data exfiltration, and anti-analysis techniques.</p>

<h2 class="section-heading">Static & Blackbox Analysis</h2>
<p>The malicious file, typically disguised as a “quotation” or “invoice,” lures users into opening an SHTML page. Upon execution, the victim is presented with multiple document download options such as:</p>
<ul>
  <li>Company Profile</li>
  <li>Company Registration Certificate</li>
  <li>Order Technical Specifications (Excel format)</li>
</ul>
<p>When the victim clicks a button to download one of these documents, a fake download progress bar is displayed, stopping at <strong>75%</strong>. At this point, the victim is prompted to log in with their <strong>corporate email credentials</strong> to “complete the download.”</p>

<img class="img-fluid" src="/img/posts/Phish1/1.png" alt="Virustotal file sample">
<span class="caption text-muted">Fig. 1 — SHTML sample submitted to VirusTotal</span>

<img class="img-fluid" src="/img/posts/Phish1/2.png" alt="SHTML file execution">
<span class="caption text-muted">Fig. 2 — Fake invoice download page shown to victim</span>

<p>Once entered, credentials are transmitted to a remote server. In this campaign, the data was sent to:</p>
<p><code>hxxp://amon3y[.]com/pdf/test/file10.php</code></p>
<p>The following domain: <code>amon3y.com</code> is a <strong>newly registered domain</strong>, a key red flag in phishing and malware campaigns. Threat actors often rely on freshly created infrastructure to evade reputation-based security tools, since security vendors typically take days or weeks to update blocklists. Newly created domains rarely have legitimate business use unless tied to a verified brand launch, making them immediately suspicious.</p>

<p>Despite its simplicity, the phishing kit uses <strong>OneDrive logos and cloud-like UI elements</strong> to increase legitimacy. For less technical victims, this is convincing enough to submit credentials, especially when targeted with a pre-validated list of email addresses.</p>

<h2 class="section-heading">Whitebox Analysis</h2>
<p>Diving deeper into the code reveals a <strong>seven-stage phishing chain</strong> designed for persistence, deception, and enhanced data theft.</p>

<h3>Stage 1: Fake Download Progress</h3>
<p>
  <img class="img-fluid" src="/img/posts/Phish1/3.png" alt="Fake progress bar"><br>
  <span class="caption text-muted">Fig. 3 — Fake progress bar stopping at 75%</span>
</p>
<p>
  The attack begins innocently enough: when the victim clicks on one of the “Download” buttons, the page renders a loading animation resembling a document being retrieved. The bar deliberately halts at <strong>75%</strong>, a psychological trick designed to create both urgency and trust. At this point, the victim is informed that authentication is required to continue, subtly pressuring them into entering their credentials to “resume the download.” This staged interruption primes the victim by making the login request appear as a normal part of the document retrieval workflow.
</p>

<h3>Stage 2: Credential Harvesting Form</h3>
<p>
  <img class="img-fluid" src="/img/posts/Phish1/4.png" alt="Login prompt phishing"><br>
  <span class="caption text-muted">Fig. 4 — Fake login prompt for corporate email</span>
</p>
<p>
  Once stalled at 75%, the victim is presented with a seemingly legitimate corporate login form. The phishing kit captures the entered username and password, forwarding them silently to the attacker’s backend PHP script. To reinforce believability, the kit employs a fallback behavior: if the victim attempts to log in more than once, they are redirected to <code>outlook.live.com/owa/auth/errorFE.aspx</code>, mimicking a real Microsoft authentication error. This ensures that users don’t immediately suspect foul play, while attackers gain valid credentials for <strong>account takeover</strong> and further lateral movement within the organization.
</p>
<p>
  <img class="img-fluid" src="/img/posts/Phish1/11.png" alt="Login prompt phishing"><br>
  <span class="caption text-muted">Fig. 5 — Outlook Authentication Redirection Error </span>
</p>

<h3>Stage 3: Dynamic Branding with Clearbit</h3>
<p>
  <img class="img-fluid" src="/img/posts/Phish1/5.png" alt="Dynamic logo injection"><br>
  <span class="caption text-muted">Fig. 6 — Logo fetched dynamically via Clearbit API</span>
</p>
<p>
  To make the phishing page appear more legitimate, the attackers leverage the <code>logo.clearbit.com</code> API to dynamically retrieve corporate or provider logos based on the victim’s email domain. For example, entering a Gmail address automatically inserts Google’s branding, while Office 365 users see a Microsoft logo. This dynamic branding removes the need for static templates and makes the phishing attempt appear customized, significantly increasing the likelihood that victims will trust the page and hand over their credentials.
</p>

<h3>Stage 4: Cookie & Storage Exfiltration</h3>
<p>
  <img class="img-fluid" src="/img/posts/Phish1/6.png" alt="Cookie and session stealing"><br>
  <span class="caption text-muted">Fig. 7 — Script collecting cookies and storage data</span>
</p>
<p>
  Beyond credentials, the malicious script proceeds to harvest additional browser data. It targets <code>cookies</code>, <code>localStorage</code>, and <code>sessionStorage</code>, alongside other fingerprinting details. These artifacts often contain active authentication tokens, meaning attackers can bypass passwords entirely and even sidestep MFA protections by hijacking an existing session. This turns a simple phishing page into a full-blown <strong>session hijacking tool</strong>, enabling attackers to impersonate the victim without triggering additional login alerts.
</p>

<h3>Stage 5: Stealth Logger & Fingerprinting</h3>
<p>
  <img class="img-fluid" src="/img/posts/Phish1/7.png" alt="System profiling exfiltration"><br>
  <span class="caption text-muted">Fig. 8 — System fingerprinting sent to attacker</span>
</p>
<p>
  The phishing kit doesn’t stop at browser storage. It also runs a lightweight <strong>stealth logger</strong> that collects system metadata such as language settings, operating system, timezone, screen resolution, and referrer URL. This fingerprinting data is quietly exfiltrated to the attacker’s server, helping them identify high-value corporate targets. For instance, a victim logging in from a Fortune 500 domain in a major financial hub would be prioritized over a generic webmail account. This data-driven targeting reflects a more strategic, intelligence-driven phishing operation.
</p>

<h3>Stage 6: Anti-Analysis & Lockdown</h3>
<p>
  <img class="img-fluid" src="/img/posts/Phish1/8.png" alt="Developer tool blocking"><br>
  <span class="caption text-muted">Fig. 9 — Anti-inspection script triggers fake legal notice</span>
</p>
<p>
  <img class="img-fluid" src="/img/posts/Phish1/9.png" alt="Developer tool blocking"><br>
  <span class="caption text-muted">Fig. 10 — Actual image of Anti-inspection script triggers fake legal notice</span>
</p>
<p>
  To slow down researchers and prevent casual users from spotting suspicious behavior, the script deploys multiple <strong>anti-analysis techniques</strong>. Common browser actions such as opening Developer Tools (F12), viewing source code, right-clicking, or copying content are blocked. If tampering is detected, the page triggers an intimidating fake “legal warning,” suggesting unauthorized inspection is a violation of law. While technically unsophisticated, this social engineering defense can discourage novice analysts or system administrators from investigating further.
</p>

<h3>Stage 7: Email Injection from URL</h3>
<p>
  <img class="img-fluid" src="/img/posts/Phish1/10.1.png" alt="Prefilled login injection"><br>
  <span class="caption text-muted">Fig. 11 — Email prefilled in phishing form via URL</span>
</p>
<p>
  Finally, the phishing kit personalizes the attack through <strong>email injection</strong>. By parsing URL parameters such as <code>?cms=victim@company.com</code>, the script automatically pre-fills the email field with the victim’s address. This small but clever detail eliminates friction—users don’t need to type their email, making the form feel seamless and authentic. At the same time, it increases believability by demonstrating that the page “already knows” who the user is, reinforcing the illusion of a legitimate workflow tailored to them.
</p>

<h2 class="section-heading">Summary</h2>
<p>This SHTML phishing campaign demonstrates how attackers combine <strong>simple deception with multi-layered data theft</strong>. Despite its unsophisticated design, it integrates:</p>
<ul>
  <li>Credential harvesting with realistic error redirection</li>
  <li>Dynamic branding to match victim organizations</li>
  <li>Session hijacking through cookie/storage theft</li>
  <li>Anti-analysis measures to delay investigation</li>
</ul>
<p>These tactics show that even poorly crafted kits can cause <strong>severe corporate impact</strong> if email security and user awareness training are not enforced. Organizations should monitor for SHTML attachments, enforce phishing-resistant MFA, and analyze suspicious files in a controlled sandbox environment.</p>
